# 代码规范

---

## 集成`eidtorconfig`配置

`editorconfig`有助于为不同`IDE`编辑器上处理同一项目的多个开发人员维护一致的编码风格

例如Windows的Tab和Mac的`Tab`、`Enter`编码可能不同，`Tab`缩进空格数可能不同

- `.editorconfig`

```yaml
# http://editorconfig.org

root = true

[*]  # 表示所有文件适用
charset = utf-8  # 设置文字字符集为utf8
indent_style = space  # 缩进风格（space | tab）
indent_size = 2  # 缩进大小
end_of_line = lf  # 控制换行类型（lf | cr | crlf）
trim_trailing_whitespace = true  # 去除行首的任意空白字符
insert_final_newline = true  # 始终在文件末尾添加新行

[*.md]  # 表示仅对 .md 结尾的文件使用
max_line_length = off
trim_trailing_whitespace = false
```

VS Code中需要安装`EditorConfig for VS Code`插件来读取`.editorconfig`中的配置来进行格式化

---

## 代码格式化`prettier`

`prettier`主要是对代码风格进行配置

- `.prettierrc`

```json
{
    "useTabs": false,
    "tabWidth": 2,
    "printWidth": 100,
    "singleQuote": true,
    "trailingComma": "none",
    "semi": true
}
```

不想对某些文件做代码风格格式化

- `.prettierignore`

```
/dist/*
.local
.output.js
/node_modules/**

**/*.svg
**/*.sh

/public/*
```

VS Code中安装`Prettier - Code formatter`插件自动格式化

---

## 代码规范检查`eslint`

如果`eslint`的配置和`prettier`的配置冲突

`yarn add eslint-plugin-prettier eslint-config-prettier -D`

在`.eslintrc.js`中添加`plugin:prettier/recommended`

```js
extends: [
    'plugin:vue/vue3-essential',
    'eslint:recommended',
    '@vue/typescript/recommended',
    '@vue/prettier',
    '@vue/prettier/@typescript-eslint',
    
    'plugin:prettier/recommended'
  ]
```

---

## git钩子`Husky`

通常用于`git`操作的时候需要先执行一些检查以及格式化的操作来防止不规范的代码提交

`npx husky-init && yarn`

之后会在项目根目录生成`.husky`文件夹，编辑其中的`.pre-commit`来设置钩子命令

---

## git代码提交信息

### 风格规范`commitizen`

`commitizen`是一个帮助我们规范`commit message`的工具

`yarn add commitizen -D`

`npx commitizen init cz-conventional-changelog --save-dev --save-exat`

这个命令会安装`cz-conventional-changelog`并在`package.json`中添加配置：

```json
"config": {
    "commitizen": {
        "path": "./node_modules/cz-conventional-changelog"
    }
}
```

此时提交代码则可以使用`npx cz`，或者在`package.json`中添加`scritp`:`"commit": "cz"`，之后使用`yarn commit`

第一步：选择本次更新的类型

| Type     | 作用                                                         |
| -------- | ------------------------------------------------------------ |
| feat     | 新增特性(feature)                                            |
| fix      | 修复 Bug(bug fix)                                            |
| docs     | 修改文档(documention)                                        |
| style    | 代码格式修改(white-space, formatting, missing semi colons, etc) |
| refactor | 代码重构(refactor)                                           |
| pref     | 改善性能(A code change that imporves performance)            |
| test     | 测试(when add missing tests)                                 |
| build    | 变更项目构建或外部依赖                                       |
| ci       | 更改持续集成软件的配置文件和 package 中的 scripts 命令       |
| chore    | 变更构建流程或辅助工具(例如更改测试环境)                     |
| revert   | 代码回退                                                     |

第二步：选择本次修改的范围

第三步：选择提交的信息

---

### 提交限制`commitlint`

对提交的信息进行风格验证

有了提交风格规范后但是不能阻止用户继续使用`git add . && git commit -m '.'`提交信息，因此有了`commitlint`

`yarn add @commitlint/config-conventional @commitlint/cli -D`

在项目根目录下创建`commitlint.config.js`

```js
module.exports = {
    extends: ['@commitlint/config-conventional']
}
```

在Husky中添加git钩子验证提交的信息

`npx husky add .husky/commit-msg "npx --no-install commitlint --edit $1"`